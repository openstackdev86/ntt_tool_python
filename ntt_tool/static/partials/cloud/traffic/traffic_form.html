<ng-include src="'/static/partials/common/header.html'"></ng-include>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <ol class="breadcrumb">
                <li><a href="#/cloud/">Cloud List</a></li>
                <li><a href="#/cloud/view/{$ cloudId $}/">Cloud Details</a></li>
                <li class="active">Add Traffic</li>
            </ol>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="page-header">
                <h1>{$ event | capitalize:true $} Traffic</h1>
            </div>
        </div>
    </div>
    <form name="cloudTrafficForm" ng-submit="save()">
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label>Name</label><span> * </span>
                    <input type="text" class="form-control" id="name" ng-model="cloudTraffic.name" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Remote Username</label>
                    <input type="text" class="form-control" id="remote_user" ng-model="cloudTraffic.remote_user" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Remote Password</label>
                    <input type="password" class="form-control" id="remote_pass" ng-model="cloudTraffic.remote_pass" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Allowed Delta Percentage</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="allowed_delta_percentage" ng-model="cloudTraffic.allowed_delta_percentage" required aria-describedby="allowed-delta-percentage">
                        <span class="input-group-addon" id="allowed-delta-percentage">%</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>IPERF Duration (In seconds)</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="iperf_duration" ng-model="cloudTraffic.iperf_duration" required aria-describedby="iperf-duration">
                        <span class="input-group-addon" id="iperf-duration">sec</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Number Of Workers</label>
                    <input type="number" class="form-control" id="number_of_workers" ng-model="cloudTraffic.number_of_workers" required>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Test Result Path</label>
                    <input type="text" class="form-control" id="test_result_path" ng-model="cloudTraffic.test_result_path" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Test Method</label>
                    <br>
                    <div class="btn-group btn-group-justified">
                        <label class="btn btn-default" ng-model="cloudTraffic.test_method.icmp" uib-btn-checkbox>ICMP</label>
                        <label class="btn btn-default" ng-model="cloudTraffic.test_method.tcp" uib-btn-checkbox>TCP</label>
                        <label class="btn btn-default" ng-model="cloudTraffic.test_method.udp" uib-btn-checkbox>UDP</label>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Tenant Type</label>
                    <!-- Todo: Enable when other features are developed -->
                    <select class="form-control" ng-model="cloudTraffic.tenant_type" ng-disabled="true">
                        <option value="all">All</option>
                        <option value="intra-tenant">Intra Tenant</option>
                        <option value="inter-tenant">Inter Tenant</option>
                        <option value="south-north">South to North</option>
                        <option value="north-south">North to South</option>
                     </select>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>SSH Gateway</label>
                    <input type="text" class="form-control" id="ssh_gateway" ng-model="cloudTraffic.ssh_gateway" required>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>External Host</label>
                    <input type="text" class="form-control" id="external_host" ng-model="cloudTraffic.external_host" required>
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label>Test Environment</label>
                    <select class="form-control" ng-model="cloudTraffic.test_environment">
                        <option value="dev">Dev/Testing</option>
                        <option value="prod">Production</option>
                     </select>
                </div>
            </div>
        </div>
        <!-- ./row -->
        <pre>{$ cloudTraffic.tenant $}</pre>
        <pre>{$ cloudTraffic.tenants $}</pre>
        <!-- For inter tenant -->
        <div ng-show="cloudTraffic.test_environment == 'dev' && cloudTraffic.tenant_type == 'intra-tenant'">
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Tenants
                        </div>
                        <table class="table table-bordered bg-white" ng-show="tenants.length > 0">
                            <tr>
                                <th>Tenant Name</th>
                                <th class="col-md-1">Status</th>
                                <th class="col-md-1"></th>
                            </tr>
                            <tr ng-repeat="tenant in tenants | orderBy:'name'">
                                <td>{$ tenant.tenant_name $}</td>
                                <td>
                                    <span class="label" ng-class="{'label-success': tenant.enabled, 'label-danger': !tenant.enabled}">
                                        {$ tenant.enabled === true ? "Enabled" : "Disabled" $}
                                    </span>
                                </td>
                                <td class="text-center">
                                    <input type="radio"
                                           ng-model="cloudTraffic.tenants[0]"
                                           ng-value="tenant"
                                           ng-checked="(cloudTraffic.tenants[0].tenant_id == tenant.tenant_id)"
                                            />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="col-md-6">

                    <div class="panel panel-default panel-light" ng-if="cloudTraffic.tenants[0]">
                        <div class="panel-heading">
                            Selected Tenant : {$ cloudTraffic.tenants[0].tenant_name $}
                            <span class="label pull-right" ng-class="{'label-success': cloudTraffic.tenants[0].enabled, 'label-danger': !cloudTraffic.tenants[0].enabled}">
                                {$ cloudTraffic.tenants[0].enabled === true ? "Enabled" : "Disabled" $}
                            </span>
                        </div>

                        <div class="list-group">
                            <div class="list-group-item" ng-repeat="network in cloudTraffic.tenants[0].networks">
                                <div class="row">
                                    <div class="col-md-5">{$ network.network_name $}</div>
                                    <div class="col-md-5">
                                        <div ng-repeat="subnet in network.subnets">
                                            <b>{$ subnet.subnet_name $}</b> : <span>{$ subnet.cidr $}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-1">{$ network.status $}</div>
                                    <div class="col-md-1 text-center">
                                        <input type="checkbox" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel-body" ng-hide="cloudTraffic.tenants[0].networks.length > 0">
                            No networks.
                        </div>
                    </div>
                    <div class="panel panel-default" ng-hide="cloudTraffic.tenants[0]">
                        <div class="panel-heading">No tenant selected</div>
                        <div class="panel-body">
                            Please select tenant
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end: For inter tenant -->

        <div class="row">
            <div class="col-md-12">
                <a href="#/cloud/view/{$ cloudId $}/" class="btn btn-default">Cancel</a>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
        <!-- ./row -->
    </form>
</div>